services:
  suwayomi-server:
    # build:
    #   context: ./Suwayomi-Server
    #   dockerfile: Dockerfile
    image: ghcr.io/penguarjol/tachiyomi-saas/server:latest
    ports:
      - "4567:4567"
    environment:
      - JAVA_OPTS=-Xmx2048m -Djava.awt.headless=true -Dsuwayomi.tachidesk.config.server.rootDir=/data -Dserver.initialOpenInBrowserEnabled=false -Dserver.systemTrayEnabled=false
      - TS_CONFIG_server_systemTrayEnabled=false
      - TS_CONFIG_server_initialOpenInBrowserEnabled=false
      - TS_CONFIG_server_authMode='BASIC_AUTH'
      - TS_CONFIG_server_authUsername='suwayomi'
      - TS_CONFIG_server_authPassword='suwayomi'
      - TEST_ENV=true
      - SUWAYOMI_DISABLE_UPDATE_CHECK=true
    volumes:
      - suwayomi-data:/data
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:4567/api/v1/settings" ]
      interval: 30s
      timeout: 10s
      retries: 3

  suwayomi-gatekeeper:
    # build:
    #   context: ./Suwayomi-Gatekeeper
    #   dockerfile: Dockerfile
    image: ghcr.io/penguarjol/tachiyomi-saas/gatekeeper:latest
    ports:
      - "8080:8080"
    environment:
      - SUWAYOMI_URL=http://suwayomi-server:4567
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
    volumes:
      - ./Suwayomi-Gatekeeper:/app
      - /app/node_modules
    depends_on:
      - suwayomi-server

volumes:
  suwayomi-data:
